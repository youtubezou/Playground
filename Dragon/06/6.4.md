## 6.4 Translation of Expressions

### 6.4.1

> Add to the translation of Fig. 6.19 rules for the following productions:

> a) $$E~\rightarrow~E_1~*~E_2$$.

> b) $$E~\rightarrow~+~E_1$$.

| PRODUCTION | SEMANTIC RULES |
|:-----------|:---------------|
|$$S\rightarrow\mathbf{id}=E;$$|$$\begin{array}{ll}S.code =&E.code~||~\\ &gen(top.get(\mathbf{id}.lexeme)~'='~E.addr)\end{array}$$|
|$$E\rightarrow E_1+E_2$$|$$\begin{array}{ll}E.addr =& \mathbf{new}~Temp()\\ E.code =& E_1.code~||~E_2.code~||~\\&gen(E.addr~'='~E_1.addr~'+'~E_2.addr)\end{array}$$|
|$$E\rightarrow E_1*E_2$$|$$\begin{array}{ll}E.addr =& \mathbf{new}~Temp()\\ E.code =& E_1.code~||~E_2.code~||~\\&gen(E.addr~'='~E_1.addr~'*'~E_2.addr)\end{array}$$|
|$$~~|+E_1$$|$$\begin{array}{ll}E.addr =& E_1.addr\\ E.code =& E_1.code\end{array}$$|
|$$~~|-E_1$$|$$\begin{array}{ll}E.addr =& \mathbf{new}~Temp()\\ E.code =& E_1.code~||~\\&gen(E.addr~'='~'\mathbf{minus}'~E_1.addr)\end{array}$$|
|$$~~|~(E_1)$$|$$\begin{array}{ll}E.addr=&E_1.addr\\E.code=&E_1.code\end{array}$$|
|$$~~|~\mathbf{id}$$|$$\begin{array}{ll}E.addr=&top.get(\mathbf{id}.lexeme)\\ E.code =& ''\end{array}$$

### 6.4.2

> Repeat Exercise 6.4.1 for the incremental translation of Fig. 6.20.

$$\begin{array}{rcll}
S &\rightarrow& \mathbf{id} = E; & \{ gen(top.get(\mathbf{id}.lexeme)~'='~E.addr);\} \\
E &\rightarrow& E_1 + E_2 & \{ E.addr = \mathbf{new}~Temp();\\
&&& ~gen(E.addr~'='~E_1.addr~'+'~+E_2.addr;\}\\
E &\rightarrow& E_1 * E_2 & \{ E.addr = \mathbf{new}~Temp();\\
&&& ~gen(E.addr~'='~E_1.addr~'*'~+E_2.addr;\}\\
&|& +E_1& \{ E.addr = E_1.addr; \}\\
&|& -E_1& \{ E.addr = \mathbf{new}~Temp();\\
&&& ~gen(E.addr~'='~'\mathbf{minus}'~E_1.addr;\}\\
&|& (E_1)& \{ E.addr = E_1.addr; \}\\
&|& \mathbf{id}& \{ E.addr = top.get(\mathbf{id}.lexeme); \}\\
\end{array}$$

### 6.4.3

> Use the translation of Fig. 6.22 to translate the following assignments:

> a) `x = a[i] + b[j]`.

```
t1 = a.type.width * i
t2 = a.array.base [ t1 ]
t3 = b.type.width * j
t4 = b.array.base [ t3 ]
t5 = t2 + t4
x = t5
```

> b) `x = a[i][j] + b[i][j]`.

```
t1 = a.type.width * i
t2 = a.type.elem.type.width * j
t3 = t1 + t2
t4 = a.array.base [ t3 ]
t5 = b.type.width * i
t6 = b.type.elem.type.width * j
t7 = t1 + t2
t8 = b.array.base [ t7 ]
t9 = t4 + t8
x = t9
```

> c) `x = a[b[i][j]][c[k]]`.

```
t1 = b.type.width * i
t2 = b.type.elem.type.width * j
t3 = t1 + t2
t4 = b.array.base [ t3 ]
t5 = a.type.width * t4
t6 = c.type.width * k
t7 = c.array.base [ t6 ]
t8 = a.type.elem.type.width * t7
t9 = t5 + t8
t10 = a.array.base [ t9 ]
x = t10
```

### 6.4.4

> Revise the translation of Fig. 6.22 for array references of the Fortran style, that is, $$\mathbf{id}[E_1, E_2, \dots, E_n]$$ for an $$n$$-dimensional array.
