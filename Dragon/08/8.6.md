#
# 8.6 A Simple Code Generator

### 8.6.1

> For each of the following C assignment statements generate three-address code, assuming that all array elements are integers taking four bytes each. In parts (d) and (e), assume that `a`, `b` and `c` are constants giving the location of the first (0th) elements of the arrays with those names, as in all previous examples of array accesses in this chapter.

> a) `x = a + b*c;`

```
t1 = b * c
t2 = a + t1
x = t2
```

> b) `x = a/(b+c) - d*(e+f);`

```
t1 = b + c
t2 = a / t1
t3 = e + f
t4 = d * t3
t5 = t2 - t4
x = t5
```

> c) `x = a[i] + 1;`

```
t1 = i * 4
t2 = a[t1]
t3 = t2 + 1
x = t3
```

> d) `a[i] = b[c[i]];`

```
t1 = i * 4
t2 = c[t1]
t3 = t2 * 4
t4 = b[t3]
a[t1] = t4
```

> e) `a[i][j] = b[i][k] + c[k][j];`

```
t1 = i * n
t2 = t1 + k
t3 = t2 * 4
t4 = b[t3]
t5 = k * n
t6 = t5 + j
t7 = t6 * 4
t8 = c[t7]
t9 = t4 + t8
t10 = t1 + j
t11 = t10 * 4
a[t11] = t9
```

> f) `*p++ = *q++;`

Assume that `++` has higher priority than `*`.

```
t1 = *q
t2 = q + 4
q = t2
*p = t1
t3 = p + 4
p = t3
```

### 8.6.2

> Repeat Exercise 8.6.1 parts (d) and (e), assuming that the arrays `a`, `b` and `c` are located via pointers, `pa`, `pb`, `pc`, respectively, pointing to the locations of their respective first elements.

> d) `a[i] = b[c[i]];`

```
t1 = i * 4
t2 = pc + t1
t3 = *t2
t4 = t3 * 4
t5 = pb + t4
t6 = *t5
t7 = pa + t1
*t7 = t6
```

> e) `a[i][j] = b[i][k] + c[k][j];`

```
t1 = i * n
t2 = t1 + k
t3 = t2 * 4
t4 = pb + t3
t5 = *t4

t6 = k * n
t7 = t6 + j
t8 = t7 * 4
t9 = pc + t8
t10 = *t9

t11 = t5 + t10

t12 = t1 + j
t13 = t12 * 4
t14 = pa + t13
*t14 = t11
```

### 8.6.3

> Convert your three-address code from Exercise 8.6.1 into machine code for the machine model of this section. You may use as many registers as you need.

> a) `x = a + b*c;`

```
t1 = b * c
t2 = a + t1
x = t2
```

* Entry: 

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
|  |  |  |  |  |

Addresses: 

| `a` | `b` | `c` | `t1` | `t2` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `a` | `b` | `c` |  |  | `x` |

* `t1 = b * c`

Generated: 

```
LD  R1, b
LD  R2, c
MUL R3, R1, R2
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` |  |  |

Addresses: 

| `a` | `b` | `c` | `t1` | `t2` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `a` | `R1,b` | `R2,c` | `R3` |  | `x` |

* `t2 = a + t1`

Generated: 

```
LD  R4, a
ADD R5, R4, R3
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` |

Addresses: 

| `a` | `b` | `c` | `t1` | `t2` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R3` | `R5` | `x` |

* `x = t2`

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2,x` |

Addresses: 

| `a` | `b` | `c` | `t1` | `t2` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R3` | `R5` | `R5` |

* Exit: 

Generated: 

```
ST  x, R5
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2,x` |

Addresses: 

| `a` | `b` | `c` | `t1` | `t2` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R3` | `R5` | `R5,x` |

* Complete: 

```
LD  R1, b
LD  R2, c
MUL R3, R1, R2
LD  R4, a
ADD R5, R4, R3
ST  x, R5
```

> b) `x = a/(b+c) - d*(e+f);`

```
t1 = b + c
t2 = a / t1
t3 = e + f
t4 = d * t3
t5 = t2 - t4
x = t5
```

* Entry: 

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|  |  |  |  |  |  |  |  |  |  |  |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a` | `b` | `c` | `d` | `e` | `f` |  |  |  |  |  | `x` |

* `t1 = b + c`

Generated: 

```
LD  R1, b
LD  R2, c
ADD R3, R1, R2
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` |  |  |  |  |  |  |  |  |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a` | `R1,b` | `R2,c` | `d` | `e` | `f` | `R3` |  |  |  |  | `x` |

* `t2 = a / t1`

Generated: 

```
LD  R4, a
DIV R5, R4, R3
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` |  |  |  |  |  |  |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `d` | `e` | `f` | `R3` | `R5` |  |  |  | `x` |

* `t3 = e + f`

Generated: 

```
LD  R6, e
LD  R7, f
ADD R8, R6, R7
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` | `e` | `f` | `t3` |  |  |  |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `d` | `R6,e` | `R7,f` | `R3` | `R5` | `R8` |  |  | `x` |

* `t4 = d * t3`

Generated: 

```
LD  R9, d
MUL R10, R9, R8
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` | `e` | `f` | `t3` | `d` | `t4` |  |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R9,d` | `R6,e` | `R7,f` | `R3` | `R5` | `R8` | `R10` |  | `x` |

* `t5 = t2 - t4`

Generated: 

```
SUB R11, R5, R10
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` | `e` | `f` | `t3` | `d` | `t4` | `t5` |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R9,d` | `R6,e` | `R7,f` | `R3` | `R5` | `R8` | `R10` | `R11` | `x` |

* `x = t5`

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` | `e` | `f` | `t3` | `d` | `t4` | `t5,x` |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R9,d` | `R6,e` | `R7,f` | `R3` | `R5` | `R8` | `R10` | `R11` | `R11` |

* Exit: 

Generated: 

```
ST  x, R11
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `b` | `c` | `t1` | `a` | `t2` | `e` | `f` | `t3` | `d` | `t4` | `t5,x` |

Addresses: 

| `a` | `b` | `c` | `d` | `e` | `f` | `t1` | `t2` | `t3` | `t4` | `t5` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R4,a` | `R1,b` | `R2,c` | `R9,d` | `R6,e` | `R7,f` | `R3` | `R5` | `R8` | `R10` | `R11` | `R11,x` |

* Complete: 

```
LD  R1, b
LD  R2, c
ADD R3, R1, R2
LD  R4, a
DIV R5, R4, R3
LD  R6, e
LD  R7, f
ADD R8, R6, R7
LD  R9, d
MUL R10, R9, R8
SUB R11, R5, R10
ST  x, R11
```

> c) `x = a[i] + 1;`

```
t1 = i * 4
t2 = a[t1]
t3 = t2 + 1
x = t3
```

* Entry: 

Registers: 

| R1 | R2 | R3 | R4 |
|:-:|:-:|:-:|:-:|
|  |  |  |  |

Addresses: 

| `a[t1]` | `i` | `t1` | `t2` | `t3` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `i` |  |  |  | `x` |

* `t1 = i * 4`

Generated: 

```
LD  R1, i
MUL R2, R1, #4
```

Registers: 

| R1 | R2 | R3 | R4 |
|:-:|:-:|:-:|:-:|
| `i` | `t1` |  |  |

Addresses: 

| `a[t1]` | `i` | `t1` | `t2` | `t3` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `R1,i` | `R2` |  |  | `x` |

* `t2 = a[t1]`

Generated: 

```
LD  R3, a[t1]
```

Registers: 

| R1 | R2 | R3 | R4 |
|:-:|:-:|:-:|:-:|
| `i` | `t1` | `a[t1],t2` |  |

Addresses: 

| `a[t1]` | `i` | `t1` | `t2` | `t3` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R3,a[t1]` | `R1,i` | `R2` | `R3` |  | `x` |

* `t3 = t2 + 1`

Generated: 

```
ADD R4, R3, #1
```

Registers: 

| R1 | R2 | R3 | R4 |
|:-:|:-:|:-:|:-:|
| `i` | `t1` | `a[t1],t2` | `t3` |

Addresses: 

| `a[t1]` | `i` | `t1` | `t2` | `t3` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R3,a[t1]` | `R1,i` | `R2` | `R3` | `R4` | `x` |

* `x = t3`

Registers: 

| R1 | R2 | R3 | R4 |
|:-:|:-:|:-:|:-:|
| `i` | `t1` | `a[t1],t2` | `t3,x` |

Addresses: 

| `a[t1]` | `i` | `t1` | `t2` | `t3` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R3,a[t1]` | `R1,i` | `R2` | `R3` | `R4` | `R4` |

* Exit: 

Generated: 

```
ST  x, R4
```

Registers: 

| R1 | R2 | R3 | R4 |
|:-:|:-:|:-:|:-:|
| `i` | `t1` | `a[t1],t2` | `t3,x` |

Addresses: 

| `a[t1]` | `i` | `t1` | `t2` | `t3` | `x` |
|:-:|:-:|:-:|:-:|:-:|:-:|
| `R3,a[t1]` | `R1,i` | `R2` | `R3` | `R4` | `R4,x` |

* Complete: 

```
LD  R1, i
MUL R2, R1, #4
LD  R3, a[t1]
ADD R4, R3, #1
ST  x, R4
```

> d) `a[i] = b[c[i]];`

```
t1 = i * 4
t2 = c[t1]
t3 = t2 * 4
t4 = b[t3]
a[t1] = t4
```

* Entry: 

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
|  |  |  |  |  |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `b[t3]` | `c[t1]` | `i` |  |  |  |  |

* `t1 = i * 4`

Generated: 

```
LD  R1, i
MUL R2, R1, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `i` | `t1` |  |  |  |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `b[t3]` | `c[t1]` | `R1,i` | `R2` |  |  |  |

* `t2 = c[t1]`

Generated: 

```
LD  R3, c[t1]
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `i` | `t1` | `c[t1],t2` |  |  |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `b[t3]` | `R3,c[t1]` | `R1,i` | `R2` | `R3` |  |  |

* `t3 = t2 * 4`

Generated: 

```
MUL R4, R3, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `i` | `t1` | `c[t1],t2` | `t3` |  |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `b[t3]` | `R3,c[t1]` | `R1,i` | `R2` | `R3` | `R4` |  |

* `t4 = b[t3]`

Generated: 

```
LD  R5, b[t3]
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `i` | `t1` | `c[t1],t2` | `t3` | `b[t3],t4` |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t1]` | `R5,b[t3]` | `R3,c[t1]` | `R1,i` | `R2` | `R3` | `R4` | `R5` |

* `a[t1] = t4`

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `i` | `t1` | `c[t1],t2` | `t3` | `a[t1],b[t3],t4` |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R5` | `R5,b[t3]` | `R3,c[t1]` | `R1,i` | `R2` | `R3` | `R4` | `R5` |

* Exit: 

Generated: 

```
ST  a[t1], R5
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `i` | `t1` | `c[t1],t2` | `t3` | `a[t1],b[t3],t4` |

Addresses: 

| `a[t1]` | `b[t3]` | `c[t1]` | `i` | `t1` | `t2` | `t3` | `t4` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R5,a[t1]` | `R5,b[t3]` | `R3,c[t1]` | `R1,i` | `R2` | `R3` | `R4` | `R5` |

* Complete: 

```
LD  R1, i
MUL R2, R1, #4
LD  R3, c[t1]
MUL R4, R3, #4
LD  R5, b[t3]
ST  a[t1], R5
```

> e) `a[i][j] = b[i][k] + c[k][j];`

```
t1 = i * n
t2 = t1 + k
t3 = t2 * 4
t4 = b[t3]
t5 = k * n
t6 = t5 + j
t7 = t6 * 4
t8 = c[t7]
t9 = t4 + t8
t10 = t1 + j
t11 = t10 * 4
a[t11] = t9
```

* Entry: 

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|  |  |  |  |  |  |  |  |  |  |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` |  |  |  |  |  |  |  |  |  |  |  |

* `t1 = i * n`

Generated: 

```
LD  R1, i
LD  R2, n
MUL R3, R1, R2
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` |  |  |  |  |  |  |  |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `b[t3]` | `c[t7]` | `R1,i` | `j` | `k` | `R2,n` | `R3` |  |  |  |  |  |  |  |  |  |  |

* `t2 = t1 + k`

Generated: 

```
LD  R4, k
ADD R5, R3, R4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` |  |  |  |  |  |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `b[t3]` | `c[t7]` | `R1,i` | `j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` |  |  |  |  |  |  |  |

* `t3 = t2 * 4`

Generated: 

```
MUL R6, R5, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` |  |  |  |  |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `b[t3]` | `c[t7]` | `R1,i` | `j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` |  |  |  |  |  |  |

* `t4 = b[t3]`

Generated: 

```
LD  R7, b[t3]
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` |  |  |  |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `c[t7]` | `R1,i` | `j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` | `R7` |  |  |  |  |  |

* `t5 = k * n`

Generated: 

```
MUL R8, R4, R2
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` |  |  |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `c[t7]` | `R1,i` | `j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` | `R7` | `R8` |  |  |  |  |

* `t6 = t5 + j`

Generated: 

```
LD  R9, j
ADD R10, R8, R9
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` |  |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` | `R7` | `R8` | `R10` |  |  |  |

* `t7 = t6 * 4`

Generated: 

```
MUL R11, R10, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` |  |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` |  |  |

* `t8 = c[t7]`

Generated: 

```
LD  R12, c[t7]
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` | `c[t7],t8` |  |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `R12,c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` | `R12` |  |

* `t9 = t4 + t8`

Generated: 

```
ADD R13, R7, R12
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` | `c[t7],t8` | `t9` |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `R12,c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` |  |  | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` | `R12` | `R13` |

* `t10 = t1 + j`

Generated: 

```
ADD R14, R3, R9
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 | R14 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` | `c[t7],t8` | `t9` | `t10` |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `R12,c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` | `R14` |  | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` | `R12` | `R13` |

* `t11 = t10 * 4`

Generated: 

```
MUL R15, R14, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 | R14 | R15 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` | `c[t7],t8` | `t9` | `t10` | `t11` |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `a[t11]` | `R7,b[t3]` | `R12,c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` | `R14` | `R15` | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` | `R12` | `R13` |

* `a[t11] = t9`

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 | R14 | R15 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` | `c[t7],t8` | `a[t11],t9` | `t10` | `t11` |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R13` | `R7,b[t3]` | `R12,c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` | `R14` | `R15` | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` | `R12` | `R13` |

* Exit: 

Generated: 

```
ST  a[t11], R13
```

Registers: 

| R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 | R11 | R12 | R13 | R14 | R15 |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `i` | `n` | `t1` | `k` | `t2` | `t3` | `b[t3],t4` | `t5` | `j` | `t6` | `t7` | `c[t7],t8` | `a[t11],t9` | `t10` | `t11` |

Addresses: 

| `a[t11]` | `b[t3]` | `c[t7]` | `i` | `j` | `k` | `n` | `t1` | `t10` | `t11` | `t2` | `t3` | `t4` | `t5` | `t6` | `t7` | `t8` | `t9` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R13,a[t11]` | `R7,b[t3]` | `R12,c[t7]` | `R1,i` | `R9,j` | `R4,k` | `R2,n` | `R3` | `R14` | `R15` | `R5` | `R6` | `R7` | `R8` | `R10` | `R11` | `R12` | `R13` |

* Complete: 

```
LD  R1, i
LD  R2, n
MUL R3, R1, R2
LD  R4, k
ADD R5, R3, R4
MUL R6, R5, #4
LD  R7, b[t3]
MUL R8, R4, R2
LD  R9, j
ADD R10, R8, R9
MUL R11, R10, #4
LD  R12, c[t7]
ADD R13, R7, R12
ADD R14, R3, R9
MUL R15, R14, #4
ST  a[t11], R13
```

> f) `*p++ = *q++;`

* Entry: 

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
|  |  |  |  |  |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `*p` | `*q` | `p` | `q` |  |  |  |

* `t1 = *q`

Generated: 

```
LD  R1, *q
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*q,t1` |  |  |  |  |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `*p` | `*q,R1` | `p` | `q` | `R1` |  |  |

* `t2 = q + 4`

Generated: 

```
LD  R2, q
ADD R3, R2, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*q,t1` | `q` | `t2` |  |  |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `*p` | `*q,R1` | `p` | `R2,q` | `R1` | `R3` |  |

* `q = t2`

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*q,t1` | `q` | `q,t2` |  |  |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `*p` | `*q,R1` | `p` | `R3` | `R1` | `R3` |  |

* `*p = t1`

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*p,*q,t1` | `q` | `q,t2` |  |  |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R1` | `*q,R1` | `p` | `R3` | `R1` | `R3` |  |

* `t3 = p + 4`

Generated: 

```
LD  R4, p
ADD R5, R4, #4
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*p,*q,t1` | `q` | `q,t2` | `p` | `t3` |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R1` | `*q,R1` | `R4,p` | `R3` | `R1` | `R3` | `R5` |

* `p = t3`

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*p,*q,t1` | `q` | `q,t2` | `p` | `p,t3` |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `R1` | `*q,R1` | `R5` | `R3` | `R1` | `R3` | `R5` |

* Exit: 

Generated: 

```
ST  *p, R1
ST  q, R3
ST  p, R5
```

Registers: 

| R1 | R2 | R3 | R4 | R5 |
|:-:|:-:|:-:|:-:|:-:|
| `*p,*q,t1` | `q` | `q,t2` | `p` | `p,t3` |

Addresses: 

| `*p` | `*q` | `p` | `q` | `t1` | `t2` | `t3` |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| `*p,R1` | `*q,R1` | `R5,p` | `R3,q` | `R1` | `R3` | `R5` |

* Complete: 

```
LD  R1, *q
LD  R2, q
ADD R3, R2, #4
LD  R4, p
ADD R5, R4, #4
ST  *p, R1
ST  q, R3
ST  p, R5
```

### 8.6.4

> Convert your three-address code from Exercise 8.6.1 into machine code, using the simple code-generation algorithm of this section, assuming three registers are available. Show the register and address descriptors after each step.

### 8.6.5

> Repeat Exercise 8.6.4, but assuming only two registers are available.
